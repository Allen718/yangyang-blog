## 记账页面
### Money.tsx 的UI 完成
1. 根据设计稿，将TagsSection的结构先搞清楚，然后就开始写HTML，然后写css
```
 <TagsSection>
        <ol>
          <li>衣</li>
          <li>食</li>
          <li>住</li>
          <li>行</li>
        </ol>
        <button>新增标签</button>
      </TagsSection>
      const TagsSection = styled.section`
  background: #FFFFFF; padding: 12px 16px;
  > ol { margin: 0 -12px;
    > li{
       background: #D9D9D9; border-radius: 18px;
       display:inline-block; padding: 3px 18px; 
       font-size: 14px; margin: 8px 12px;
    }
  }
  > button{
    background:none; border: none; padding: 2px 4px;
    border-bottom: 1px solid #333; color: #666;
    margin-top: 8px;
  }
`;
```
2. 由于ui主要就是完成设计稿的样式，就不用一一叙述，就自己看看源码就可以了，重点讲讲需要注意或掌握的地方就可以。在制作数字面板的时候需要用到浮动，为了清楚浮动，我们需要给浮动元素的父元素加上clearfix,具体如下
```
.clearfix::after {
  content: '';
  display: block;
  clear: both;
}
```
3. 写完组件的ui以后，我们会发现，一屏没有占满，我们希望将多余的空间全都留给Tags 部分，那就需要调整css布局，需要将layout的content部分为flex布局然后，采用flex-grow完成。可以这样做,不过这样写就不可以在组件里面直接写css了，而是引入一个css文件。
```
function Money() {
  return {
    <Layout className='xxx'>
   然后在layout里面
   const Layout = (props: any) => {
  return (
    <Wrapper>
      <Main className={props.className}>
        {props.children}
      </Main>
      <Nav/>
    </Wrapper>
  );
};
```
方法二 ,styled components支持任何类型的组件，也就意味着自定义的也可以，代码改动如下。
```
const MyLayout = styled(Layout)`
  display:flex;
  flex-direction: column;
`
function Money() {
  return {
    <MyLayout>
      <TagsSection>
        <ol>
          <li>衣</li>
  ```
  4. ui基本完成，由于尽量不要使得一个组件里面文件过大，我们需要模块化这个Money.tsx这个里面的各个模块是得成为独立的组件。
 ### Money.tsx 的功能实现
#### 完成标签的选择和新增
 使用函数创建组件`const TagsSection: React.FC = (props) => {}`,首先我们需要有标签这个数据，还得有修改标签和读取标签这两个功能，然后在一次记账过程中还得需要有选中标签这个数据
 ```
 const [tags, setTags] = useState<string[]>(['衣', '食', '住', '行']);
  const [selectedTags, setSelectedTags] = useState<string[]>([]);
  const onAddTag = () => {
    const tagName = window.prompt('新标签的名称为');
    if (tagName !== null) {
      setTags([...tags, tagName]);
    }
  };
  const onToggleTag = (tag: string) => {
    const index = selectedTags.indexOf(tag);
    if (index >= 0) {
      // 如果 tag 已被选中，就复制所有没有被选中的 tag，作为新的 selectedTag
      setSelectedTags(selectedTags.filter(t => t !== tag));
    } else {
      setSelectedTags([...selectedTags, tag]);
    }
  };
  const getClass = (tag: string) => selectedTags.indexOf(tag) >= 0 ? 'selected' : '';
  return (
    <Wrapper>
      <ol>
        {tags.map(tag =>
          <li key={tag} onClick={
            () => {onToggleTag(tag);}
          } className={getClass(tag)}
          >{tag}</li>
        )}
      </ol>
      <button onClick={onAddTag}>新增标签</button>
    </Wrapper>
  );
  ```
 #### 完成备注的功能
  首先使用ref获取到这个input元素，然后对它事件监听
  ```
  const NoteSection: React.FC = () => {
  const [note, setNote] = useState('');
  const refInput = useRef<HTMLInputElement>(null);
  const onBlur = () => {
    if (refInput.current !== null) {
      setNote(refInput.current.value);
    }
  };
  return (
    <Wrapper>
      <label>
        <span>备注</span>
        <input type="text" placeholder="在这里添加备注"
               ref={refInput}
               defaultValue={note}
               onBlur={onBlur}
        />
      </label>
    </Wrapper>
  );
};
  ```
  #### category 切换功能实现
  ```
  const CategorySection: React.FC = () => {
  const categoryMap = {'-': '支出', '+': '收入'};
  const [categoryList] = useState<('+' | '-')[]>(['-', '+']);
  const [category, setCategory] = useState('-');
  return (
    <Wrapper>
      <ul>
        {categoryList.map(c =>
          <li className={category === c ? 'selected' : ''}
              onClick={() => {setCategory(c);}}
          >{categoryMap[c]}
          </li>
        )}
      </ul>
    </Wrapper>
  );
};
  ```
#### numberPad 功能实现，
首先很确定在面板显示的是字符串，而不会是数字，因为数字不会出现'0.'这种状态。
  ```
  const NumberPadSection: React.FC = () => {
  const onClickButtonWrapper = (e: React.MouseEvent) => {
  const [output, _setOutput] = useState('0');
  const setOutput = (output: string) => {
    if (output.length > 16) {
      output = output.slice(0, 16);
    } else if (output.length === 0) {
      output = '0';
    }
    _setOutput(output);
  };
    const text = (e.target as HTMLButtonElement).textContent;
    if (text === null) {return;}
    switch (text) {
      case '0':
      case '1':
      case '2':
      case '3':
      case '4':
      case '5':
      case '6':
      case '7':
      case '8':
      case '9':
        if (output === '0') {
          setOutput(text);
        } else {
          setOutput(output + text);
        }
        break;
   case '.':
        if (output.indexOf('.') >= 0) {return;}
        setOutput(output + '.');
        break;
      case '删除':
        if (output.length === 1) {
          setOutput('');
        } else {
          setOutput(output.slice(0, -1));
        }
        break;
      case '清空':
      setOutput('');
        break;
      case 'OK':
      
        break;
    }
  };
  return (
    <Wrapper>
      <div className="output">
        {output}
      </div>
      <div className="pad clearfix" onClick={onClickButtonWrapper}>
        <button>1</button>
        <button>2</button>
        <button>3</button>
        <button>删除</button>
        <button>4</button>
        <button>5</button>
        <button>6</button>
        <button>清空</button>
        <button>7</button>
        <button>8</button>
        <button>9</button>
        <button className="ok">OK</button>
        <button className="zero">0</button>
        <button className="dot">.</button>
      </div>
    </Wrapper>
  );
};
 ```
 #### 模块化思想
  由于这个文件内容太多，代码不方便阅读，所以将组件的样式单独抽出来为一个文件夹，再将输入面板的操作，封装成一个单独的函数
 ```
  const generateOutput = (text: string, output = '0') => {
  switch (text) {
    case '0':
    case '1':
    case '2':
    case '3':
    case '4':
    case '5':
    case '6':
    case '7':
    case '8':
    case '9':
      if (output === '0') {
        return text;
      } else {
        return output + text;
      }
    case '.':
      if (output.indexOf('.') >= 0) {return output;}
      return output + '.';
    case '删除':
      if (output.length === 1) {
        return '';
      } else {
        return output.slice(0, -1) || '';
      }
    case '清空':
      return '';
    default:
      return '';
  }
};
export {generateOutput};
  ```
  基本这个记账的页面就好了，后续有一些问题，慢慢发现，慢慢修改。
  

  