## 统计页面数据可视化
### 为记账页面添加时间
先前是哪一天记账就默认数据是那一天，为了使得记账的时间选择更加灵活，给记账页面在添加一个时间选择的功能，由于时间选择和记账页面的备注的板块十分类似，改造一下备注模块组件，使他也能为记账时间板块所用
```
<template>
  <div>
    <label class="notes">
      <span class="name">{{this.fieldName}}</span>
      <template v-if="type==='date'">
        <input :type="type" :placeholder="this.placeholder"
               :value="x(value)"
               @input="onValueChanged($event.target.value)"
              >
      </template>
      <template v-else >
        <input :type="type" :placeholder="this.placeholder"
               :value="value"
               @blur="onValueChanged($event.target.value)">
      </template>
    </label>
  </div>
</template>
 x(isoString: string) {
      return dayjs(isoString).format('YYYY-MM-DD');
    }
    onValueChanged(value: string) {
      this.$emit('update:value', value);
  }
```
当props的type为日期类型就处理一下这个数据，当日期变化，传递给外面，记录下来，记账的时候就记录好记账日期，后面的记账数据处理中不需要再有记账日期的创建了。
### 引入图表
1. 使用命令`npm install echarts --save`,`npm install @types/echarts `,安装echarts。
2. 新建一个叫做Echats的组件，然后根据官网的示例，options通过外部传入，成功的使得我们能够在页面可以看见图表就成功了
```
<template>
  <div ref="chartsWrapper" class="EchartsWrapper">
  </div>
</template>
<script lang="ts">
  import {Component, Prop,Vue,Watch} from 'vue-property-decorator';
  import echarts from 'echarts';
  @Component
  export default class Echart extends Vue {
     @Prop()options?: EChartOption
    mounted(){
      if (this.options === undefined) {
        return console.error('options 为空');
      }else{
        let chart = echarts.init(this.$refs.chartsWrapper as HTMLDivElement);
        this.chart.setOption(this.options)
      }

    }
  }
</script>
<style lang="scss" scoped>
  .EchartsWrapper{
    width: 100%;
    height:40vh;
  }
</style>
```
3. 更改图表的样式，将纵坐标的纵轴去除，横坐标的的刻度对齐等一些细节的完善，这些设置都是查echarts的官网里关于术语速查手册可以看见，自己摸索的更改就可以实现。
4. 关于数据显示的多少，如果要展示一个月的话，如果让所有数据都出现在一屏的话，会十分的小，体验感不够好，故我们设计一屏幕放七天左右的数据足矣，
```
 .echartsWrapper {
    overflow: auto;

    &::-webkit-scrollbar {
      display: none
    }

    > div {
      width: 430%;
      min-height: 40vh;
    }
  }
```
5. 处理数据，图表的样式调整好，我们就可以筛选我们的数据，使用统计页面的数据，将拿到的数据按照我们的需求处理好就可以。关于里面使用的'_'这是引入的loadash,原生js中对于数组的处理十分的友好的
```
 get dataSource() {
      const today = dayjs().format('YYYY-MM-DD');
      const array = [];
      for (let i = 0; i <= 28; i++) {
        const date = dayjs(today).subtract(i, 'day').format('YYYY-MM-DD');
       const found=  _.find(this.groupList,  {
          title:date
        });
        array.push({
         date: date, value: found ? found.total : 0
        });

      }
      array.sort((a, b) => {
        if (a.date > b.date) {return 1;} else if (a.date === b.date) {return 0;} else {return -1;}
      });
      return array;
    }
     get options() {
      const keys = this.dataSource.map(item => item.date);
      const values = this.dataSource.map(item => item.value);
      return {
        grid: {
          left: 0,
          right: 0
        },
        tooltip: {
          show: true,
          formatter: '{c}',
          position: 'top',
          backgroundColor: '#1F01FF'
        },
        xAxis: {
          type: 'category',
          axisLabel: {
            formatter: function (value: string, index: number) {
              return value.substr(5);
            }

          },
          axisTick: {
            alignWithLabel: true
          },
          data: keys,
        },
        yAxis: {
          type: 'value',
          show: false,
        },
        series: [{
          symbolSize: 15,
          symbol: 'circle',
          itemStyle: {
            color: '#1F01FF',
          },
          data: values,
          type: 'line'
        },
        ],

      };

    }

```
6. 图表基本上添加完成，但是还存在一些小问题就是当点击收入的时候图表没有切换，根据数据已经改变了，图表却没有改变，通过Log调试大法，发现原来是由于图表组件中关于渲染的方法有问题,不应该在mounted初始化并挂载，而是一旦这个options改变就初始化并渲染。

```
 @Prop()options?: EChartOption
    @Watch('options')
    onOptionsChanged(val: EChartOption) {
        this.chart!.setOption(val);

    }
    mounted(){
      if (this.options === undefined) {
        return console.error('options 为空');
      }else{
        this.chart = echarts.init(this.$refs.chartsWrapper as HTMLDivElement);
        this.chart.setOption(this.options)
      }

    }
```