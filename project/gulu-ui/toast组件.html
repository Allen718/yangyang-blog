<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Toast | 个人主页</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="杨杨的博客">
    <link rel="preload" href="/yangyang-blog/assets/css/0.styles.ef1ea67f.css" as="style"><link rel="preload" href="/yangyang-blog/assets/js/app.a824f6ad.js" as="script"><link rel="preload" href="/yangyang-blog/assets/js/2.8963be7f.js" as="script"><link rel="preload" href="/yangyang-blog/assets/js/28.96024759.js" as="script"><link rel="prefetch" href="/yangyang-blog/assets/js/10.8bc5e3b5.js"><link rel="prefetch" href="/yangyang-blog/assets/js/11.3288c351.js"><link rel="prefetch" href="/yangyang-blog/assets/js/12.99786987.js"><link rel="prefetch" href="/yangyang-blog/assets/js/13.16893be0.js"><link rel="prefetch" href="/yangyang-blog/assets/js/14.dbd35d51.js"><link rel="prefetch" href="/yangyang-blog/assets/js/15.08d6872f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/16.b2e9a03c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/17.5a114ef1.js"><link rel="prefetch" href="/yangyang-blog/assets/js/18.45f17996.js"><link rel="prefetch" href="/yangyang-blog/assets/js/19.bb7f861f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/20.30d8a940.js"><link rel="prefetch" href="/yangyang-blog/assets/js/21.df50662e.js"><link rel="prefetch" href="/yangyang-blog/assets/js/22.e9b97a2f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/23.4d4146c7.js"><link rel="prefetch" href="/yangyang-blog/assets/js/24.a3abece6.js"><link rel="prefetch" href="/yangyang-blog/assets/js/25.d23ad90c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/26.bbb8c4d0.js"><link rel="prefetch" href="/yangyang-blog/assets/js/27.d5b6268d.js"><link rel="prefetch" href="/yangyang-blog/assets/js/29.b9e7b7b4.js"><link rel="prefetch" href="/yangyang-blog/assets/js/3.492e666a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/30.cc6a8fdc.js"><link rel="prefetch" href="/yangyang-blog/assets/js/31.99421758.js"><link rel="prefetch" href="/yangyang-blog/assets/js/32.018d7e0b.js"><link rel="prefetch" href="/yangyang-blog/assets/js/33.ce4e525a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/34.ca08d911.js"><link rel="prefetch" href="/yangyang-blog/assets/js/35.377c9a13.js"><link rel="prefetch" href="/yangyang-blog/assets/js/36.599923fd.js"><link rel="prefetch" href="/yangyang-blog/assets/js/37.abec2f31.js"><link rel="prefetch" href="/yangyang-blog/assets/js/38.dab08b8a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/39.87e3d604.js"><link rel="prefetch" href="/yangyang-blog/assets/js/4.e3b17ef2.js"><link rel="prefetch" href="/yangyang-blog/assets/js/40.40c87c5f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/41.d2e5a34b.js"><link rel="prefetch" href="/yangyang-blog/assets/js/42.7b09e708.js"><link rel="prefetch" href="/yangyang-blog/assets/js/43.15065050.js"><link rel="prefetch" href="/yangyang-blog/assets/js/44.a6da690c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/45.4ded5c79.js"><link rel="prefetch" href="/yangyang-blog/assets/js/46.4b4c52a9.js"><link rel="prefetch" href="/yangyang-blog/assets/js/47.298bf686.js"><link rel="prefetch" href="/yangyang-blog/assets/js/48.1334e1af.js"><link rel="prefetch" href="/yangyang-blog/assets/js/49.96860a4c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/5.cb67b430.js"><link rel="prefetch" href="/yangyang-blog/assets/js/50.d07aca54.js"><link rel="prefetch" href="/yangyang-blog/assets/js/51.6f6b1a0c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/52.1ae2275e.js"><link rel="prefetch" href="/yangyang-blog/assets/js/53.ea310c17.js"><link rel="prefetch" href="/yangyang-blog/assets/js/54.c35911e6.js"><link rel="prefetch" href="/yangyang-blog/assets/js/55.b21af298.js"><link rel="prefetch" href="/yangyang-blog/assets/js/6.a746c800.js"><link rel="prefetch" href="/yangyang-blog/assets/js/7.1764c4c7.js"><link rel="prefetch" href="/yangyang-blog/assets/js/8.22ff36bb.js"><link rel="prefetch" href="/yangyang-blog/assets/js/9.051e6cac.js">
    <link rel="stylesheet" href="/yangyang-blog/assets/css/0.styles.ef1ea67f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yangyang-blog/" class="home-link router-link-active"><img src="/yangyang-blog/image/logo.png" alt="个人主页" class="logo"> <span class="site-name can-hide">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yangyang-blog/basic/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/yangyang-blog/project/" class="nav-link router-link-active">
  项目笔记
</a></div><div class="nav-item"><a href="/yangyang-blog/mistake/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/Allen718/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/yangyang-blog/basic/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/yangyang-blog/project/" class="nav-link router-link-active">
  项目笔记
</a></div><div class="nav-item"><a href="/yangyang-blog/mistake/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/Allen718/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端导航</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yangyang-blog/project/nav/导航项目.html" class="sidebar-link">项目介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 快速记账 vue版本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 轻松记账 react版本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 造轮子 vue2.0版本</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yangyang-blog/project/gulu-ui/序言.html" class="sidebar-link">序言</a></li><li><a href="/yangyang-blog/project/gulu-ui/单元测试.html" class="sidebar-link">单元测试</a></li><li><a href="/yangyang-blog/project/gulu-ui/button组件.html" class="sidebar-link">创建Button 组件</a></li><li><a href="/yangyang-blog/project/gulu-ui/input.html" class="sidebar-link">组件input的学习回顾笔记</a></li><li><a href="/yangyang-blog/project/gulu-ui/popover.html" class="sidebar-link">popover组件回顾</a></li><li><a href="/yangyang-blog/project/gulu-ui/tabs.html" class="sidebar-link">/project/gulu-ui/tabs.html</a></li><li><a href="/yangyang-blog/project/gulu-ui/toast组件.html" class="active sidebar-link">Toast</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yangyang-blog/project/gulu-ui/toast组件.html#toast" class="sidebar-link">Toast</a></li></ul></li><li><a href="/yangyang-blog/project/gulu-ui/手风琴组件.html" class="sidebar-link">手风琴组件</a></li><li><a href="/yangyang-blog/project/gulu-ui/页面布局组件.html" class="sidebar-link">layout布局</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 造轮子 vue3.0版本</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="toast"><a href="#toast" class="header-anchor">#</a> Toast</h2> <p>新建一个toast组件，全局声明这个组件使之成为一个全局组件</p> <ol><li>如何调用这个toast组件的两种办法</li></ol> <ul><li>方法一
在toast组件里面，增加Vue的共有属性，一旦这个组件成为全局组件，所有的Vue实例都可以有这个属性</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  import Vue from 'vue'
  Vue.prototype.$toast=function(){
    console.log('hi')
  }
</code></pre></div><p>缺点 直接修改vue的共有属性，会有一些问题也许先前已经声明了一个叫做toast的方法
引入Vue，这个vue的版本也会有问题
最好的办法使用vue的自定义插件</p> <ul><li>新建一个plugin.js文件</li></ul> <div class="language- extra-class"><pre class="language-text"><code> export default{
 install(Vue,options){
   Vue.prototype.$toast=function(message){
   console.log(message)
   }
 }
}
全局声明一下使用
import plugin from './plugin.js'
Vue.use(plugin)
</code></pre></div><p>然后就可以在各个组件里面通过this.$toast来调用此函数。
方法二是更经常采用的方法，用户自己的清楚到底做了什么
动态生成一个vue组件</p> <div class="language- extra-class"><pre class="language-text"><code> Vue.prototype.$toast=function(message){
  let Constructor=Vue.extend(Toast)
      let toast=new Constructor
      toast.$slots.default=[message]//保证顺序
      toast.$mount()
      document.body.appendChild(toast.$el)
    }
</code></pre></div><p>然后vue组件开始正常写</p> <div class="language- extra-class"><pre class="language-text"><code> &lt;template&gt;
  &lt;div class=&quot;toast&quot;&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/div&gt;
 &lt;/template&gt;
 &lt;script&gt;
  export default {
    name: 'GuluToast'
  }
 &lt;/script&gt;
</code></pre></div><p>组件的css可以参考其他组件库样式</p> <h3 id="自动关闭"><a href="#自动关闭" class="header-anchor">#</a> 自动关闭</h3> <p>一般弹窗都会自动关闭，所以实现自动关闭功能</p> <div class="language- extra-class"><pre class="language-text"><code>props: {
      autoClose: {
        type: Boolean,
        default: true
      },
      autoCloseDelay: {
        type: Number,
        default: 50
      },
}
  mounted () {
      this.execAutoClose()
    },
 methods: {
     execAutoClose () {
        if (this.autoClose) {
          setTimeout(() =&gt; {
          this.$el.remove()
           this.$destroy()
          }, this.autoCloseDelay * 1000)
        }
      },
 }
</code></pre></div><h3 id="手动关闭"><a href="#手动关闭" class="header-anchor">#</a> 手动关闭</h3> <div class="language- extra-class"><pre class="language-text"><code>   Vue.prototype.$toast = function (message, toastOptions) {
   let Constructor = Vue.extend(Toast)
     let toast = new Constructor({
       propsData: {
         closeButton:  {
           text: '关闭', callback(){
               console.log('用户说他知道啦')
           }
         }
       }
     })
     toast.$slots.default = [message]
     toast.$mount()
     document.body.appendChild(toast.$el)
   }
 &lt;div class=&quot;line&quot; ref=&quot;line&quot;&gt;&lt;/div&gt;
   &lt;span class=&quot;close&quot; v-if=&quot;closeButton&quot; @click=&quot;onClickClose&quot;&gt;
     {{closeButton.text}}
   &lt;/span&gt;
closeButton: {
       type: Object,//如果为对象，默认值变成返回函数
       default () {
         return {
           text: '关闭', callback: undefined
         }
       }
     },
 onClickClose () {
       this.close()//关闭
       if (this.closeButton &amp;&amp; typeof this.closeButton.callback === 'function') {
         this.closeButton.callback(this)//this === toast实例
       }
     }
   }
</code></pre></div><h3 id="支持html选项"><a href="#支持html选项" class="header-anchor">#</a> 支持html选项</h3> <p>由于slot不支持 v-html,而我们又想要支持这个功能所以</p> <div class="language- extra-class"><pre class="language-text"><code> &lt;slot v-if=&quot;!enableHtml&quot;&gt;&lt;/slot&gt;
&lt;div v-html=&quot;$slots.default[0]&quot; v-else&gt;&lt;/div&gt;
 enableHtml: {
        type: Boolean,
        default: false,
      },

</code></pre></div><p>由于我们不知道弹框的内容是到底多大，所以高度使用最小高度，只要高度不固定那么子元素使用高度100%就会出现问题。为了所以需要解决先前写css样式的时候那条白线消失了，所以只好强制使用js将白线做出来</p> <div class="language- extra-class"><pre class="language-text"><code> updateStyle() {
        this.$nextTick(() =&gt; {
          this.$refs.line.style.height = `${this.$refs.toast.getBoundingClientRect().height}px`
        })
      }

</code></pre></div><h3 id="position位置"><a href="#position位置" class="header-anchor">#</a> position位置</h3> <p>添加类名</p> <div class="language- extra-class"><pre class="language-text"><code>   position: {
        type: String,
        default: 'top',
        validator (value) {
          return ['top', 'bottom', 'middle'].indexOf(value) &gt;= 0
        }
    computed: {
      addClass() {
        return {[`position-${this.position}`]: true}
      }
    },
</code></pre></div><p>实现只能一个toast
假设我们不停的点击出现弹框按钮那么就会创建很多虽然位置重叠，但是这个也是不可取的，我们应该实现当第二次点击弹窗的时候把第一次的干掉，然后再新创建</p> <div class="language- extra-class"><pre class="language-text"><code>import Toast from &quot;./Toast&quot;
function createToast({Vue, message, propsData,onClose}) {
  let Constructor = Vue.extend(Toast)
  let toast = new Constructor({propsData})
  toast.$slots.default = [message]
  toast.$mount()
  toast.$on('close',onClose)//当用户自己里面关闭了，我们在外面就不关闭
  document.body.appendChild(toast.$el)
   return toast

}

let currentToast
export default {
  install(Vue, options) {
    Vue.prototype.$toast = function (message, ToastOptions) {
      if (currentToast) {
      currentToast.closeToast()
        currentToast = createToast({Vue, message, propsData:ToastOptions,onClose:()=&gt;{
            currentToast=null
          }})
      } else {
        currentToast = createToast({Vue, message, propsData:ToastOptions,onClose:()=&gt;{
          currentToast=null
          }})
      }

    }
  }
}
</code></pre></div><h3 id="实现进入动画"><a href="#实现进入动画" class="header-anchor">#</a> 实现进入动画</h3> <p>实现动画的过程中会出现bug，因为我们使用了translateX后面有用translateY覆盖以后,会让动画出现问题
所以最好使用一个容器专门做样式，另一个容器专门做动画。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yangyang-blog/project/gulu-ui/tabs.html" class="prev">
        /project/gulu-ui/tabs.html
      </a></span> <span class="next"><a href="/yangyang-blog/project/gulu-ui/手风琴组件.html">
        手风琴组件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yangyang-blog/assets/js/app.a824f6ad.js" defer></script><script src="/yangyang-blog/assets/js/2.8963be7f.js" defer></script><script src="/yangyang-blog/assets/js/28.96024759.js" defer></script>
  </body>
</html>
