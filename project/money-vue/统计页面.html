<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>统计页面的制作 | 个人主页</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="杨杨的博客">
    <link rel="preload" href="/yangyang-blog/assets/css/0.styles.ef1ea67f.css" as="style"><link rel="preload" href="/yangyang-blog/assets/js/app.a824f6ad.js" as="script"><link rel="preload" href="/yangyang-blog/assets/js/2.8963be7f.js" as="script"><link rel="preload" href="/yangyang-blog/assets/js/51.6f6b1a0c.js" as="script"><link rel="prefetch" href="/yangyang-blog/assets/js/10.8bc5e3b5.js"><link rel="prefetch" href="/yangyang-blog/assets/js/11.3288c351.js"><link rel="prefetch" href="/yangyang-blog/assets/js/12.99786987.js"><link rel="prefetch" href="/yangyang-blog/assets/js/13.16893be0.js"><link rel="prefetch" href="/yangyang-blog/assets/js/14.dbd35d51.js"><link rel="prefetch" href="/yangyang-blog/assets/js/15.08d6872f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/16.b2e9a03c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/17.5a114ef1.js"><link rel="prefetch" href="/yangyang-blog/assets/js/18.45f17996.js"><link rel="prefetch" href="/yangyang-blog/assets/js/19.bb7f861f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/20.30d8a940.js"><link rel="prefetch" href="/yangyang-blog/assets/js/21.df50662e.js"><link rel="prefetch" href="/yangyang-blog/assets/js/22.e9b97a2f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/23.4d4146c7.js"><link rel="prefetch" href="/yangyang-blog/assets/js/24.a3abece6.js"><link rel="prefetch" href="/yangyang-blog/assets/js/25.d23ad90c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/26.bbb8c4d0.js"><link rel="prefetch" href="/yangyang-blog/assets/js/27.d5b6268d.js"><link rel="prefetch" href="/yangyang-blog/assets/js/28.96024759.js"><link rel="prefetch" href="/yangyang-blog/assets/js/29.b9e7b7b4.js"><link rel="prefetch" href="/yangyang-blog/assets/js/3.492e666a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/30.cc6a8fdc.js"><link rel="prefetch" href="/yangyang-blog/assets/js/31.99421758.js"><link rel="prefetch" href="/yangyang-blog/assets/js/32.018d7e0b.js"><link rel="prefetch" href="/yangyang-blog/assets/js/33.ce4e525a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/34.ca08d911.js"><link rel="prefetch" href="/yangyang-blog/assets/js/35.377c9a13.js"><link rel="prefetch" href="/yangyang-blog/assets/js/36.599923fd.js"><link rel="prefetch" href="/yangyang-blog/assets/js/37.abec2f31.js"><link rel="prefetch" href="/yangyang-blog/assets/js/38.dab08b8a.js"><link rel="prefetch" href="/yangyang-blog/assets/js/39.87e3d604.js"><link rel="prefetch" href="/yangyang-blog/assets/js/4.e3b17ef2.js"><link rel="prefetch" href="/yangyang-blog/assets/js/40.40c87c5f.js"><link rel="prefetch" href="/yangyang-blog/assets/js/41.d2e5a34b.js"><link rel="prefetch" href="/yangyang-blog/assets/js/42.7b09e708.js"><link rel="prefetch" href="/yangyang-blog/assets/js/43.15065050.js"><link rel="prefetch" href="/yangyang-blog/assets/js/44.a6da690c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/45.4ded5c79.js"><link rel="prefetch" href="/yangyang-blog/assets/js/46.4b4c52a9.js"><link rel="prefetch" href="/yangyang-blog/assets/js/47.298bf686.js"><link rel="prefetch" href="/yangyang-blog/assets/js/48.1334e1af.js"><link rel="prefetch" href="/yangyang-blog/assets/js/49.96860a4c.js"><link rel="prefetch" href="/yangyang-blog/assets/js/5.cb67b430.js"><link rel="prefetch" href="/yangyang-blog/assets/js/50.d07aca54.js"><link rel="prefetch" href="/yangyang-blog/assets/js/52.1ae2275e.js"><link rel="prefetch" href="/yangyang-blog/assets/js/53.ea310c17.js"><link rel="prefetch" href="/yangyang-blog/assets/js/54.c35911e6.js"><link rel="prefetch" href="/yangyang-blog/assets/js/55.b21af298.js"><link rel="prefetch" href="/yangyang-blog/assets/js/6.a746c800.js"><link rel="prefetch" href="/yangyang-blog/assets/js/7.1764c4c7.js"><link rel="prefetch" href="/yangyang-blog/assets/js/8.22ff36bb.js"><link rel="prefetch" href="/yangyang-blog/assets/js/9.051e6cac.js">
    <link rel="stylesheet" href="/yangyang-blog/assets/css/0.styles.ef1ea67f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yangyang-blog/" class="home-link router-link-active"><img src="/yangyang-blog/image/logo.png" alt="个人主页" class="logo"> <span class="site-name can-hide">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yangyang-blog/basic/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/yangyang-blog/project/" class="nav-link router-link-active">
  项目笔记
</a></div><div class="nav-item"><a href="/yangyang-blog/mistake/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/Allen718/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/yangyang-blog/basic/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/yangyang-blog/project/" class="nav-link router-link-active">
  项目笔记
</a></div><div class="nav-item"><a href="/yangyang-blog/mistake/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="https://github.com/Allen718/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端导航</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yangyang-blog/project/nav/导航项目.html" class="sidebar-link">项目介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span> 快速记账 vue版本</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yangyang-blog/project/money-vue/序言.html" class="sidebar-link">项目介绍</a></li><li><a href="/yangyang-blog/project/money-vue/页面布局.html" class="sidebar-link">项目的准备及配置</a></li><li><a href="/yangyang-blog/project/money-vue/Icon图标.html" class="sidebar-link">icon图标的引入</a></li><li><a href="/yangyang-blog/project/money-vue/记账页面.html" class="sidebar-link">/project/money-vue/记账页面.html</a></li><li><a href="/yangyang-blog/project/money-vue/数据管理.html" class="sidebar-link">记账数据的管理</a></li><li><a href="/yangyang-blog/project/money-vue/Vuex数据管理.html" class="sidebar-link">vuex全局数据管理</a></li><li><a href="/yangyang-blog/project/money-vue/标签页面.html" class="sidebar-link">csss书写</a></li><li><a href="/yangyang-blog/project/money-vue/标签编辑页面.html" class="sidebar-link">制作标签编辑页面</a></li><li><a href="/yangyang-blog/project/money-vue/统计页面.html" class="active sidebar-link">统计页面的制作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/yangyang-blog/project/money-vue/页面数据可视化.html" class="sidebar-link">统计页面数据可视化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 轻松记账 react版本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 造轮子 vue2.0版本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span> 造轮子 vue3.0版本</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="统计页面的制作"><a href="#统计页面的制作" class="header-anchor">#</a> 统计页面的制作</h3> <p>1.修改Types.vue,让统计页面也是可以使用这个组件，由于统计页面里面这组件当选中的时候不仅下面有黑色小横条，并且选框的颜色需要改变，但是在记账页面又不需要颜色改变，我们可以对这个组件进行二次封装，在使用Types.vue组件的statistics.vue组价里面给Type.vue组件再加类名来修改样式，为了能够给Types.vue组件里面的元素加上样式我们需要用到vue的deep属性</p> <div class="language- extra-class"><pre class="language-text"><code> .x::v-deep .li {
    background: white;
    &amp;.selected {
      background: #C4C4C4;
      &amp;::after {
        display: none;
      }
    }
  }
</code></pre></div><p>由于可能Types.vue组件里面的li元素可能比较多并且复杂的话，最好是传个前缀进去，然后定位会更加准确。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;ul class=&quot;types&quot;&gt;
     &lt;li :class=&quot;{[classPrefix+'-item']: classPrefix, selected: value==='-'}&quot;
         @click=&quot;selectType('-')&quot;&gt;支出
     &lt;/li&gt;
     &lt;li :class=&quot;{[classPrefix+'-item']: classPrefix, selected: value==='+'}&quot;
         @click=&quot;selectType('+')&quot;&gt;收入
     &lt;/li&gt;
   &lt;/ul&gt;
     
   @Prop(String) readonly value!: string;
   @Prop(String) classPrefix?: string;
statistics.vue组件这样使用
 &lt;Types class-prefix=&quot;type&quot; :data-source=&quot;typeList&quot; :value.sync=&quot;type&quot;/&gt;
::v-deep .type-tabs-item {
   background: white;
   &amp;.selected {
     background: #C4C4C4;
     &amp;::after {
       display: none;
     }
   }
 }
  
</code></pre></div><ol start="2"><li>由于设计稿中出现了一个按天 按周 按月的一个导航条，它的样式和上面的支出与收入的类型基本上一样，考虑进一步修改Types.vue组件，让他变得更加的通用，改动太多，直接重建一个叫做Tabs.vue组件，然后将Types.vue里面的有用的代码抄过来，然后开始编辑这个Tabs.vue变得更加通用，具体看文件Tabs.vue，给一个<code>@Prop({required: true, type: Array}) dataSource!: DataSourceItem[];</code>,然后将所有用到Types.vue的组件的地方全都修改成引入Tabs.vue,由于dataSource里面的 <code>typeList = [ {text: '支出', value: '-'}, {text: '收入', value: '+'}, ];</code>会多次使用，根据我与重复不共戴天原理，所以直接将其单独提出里更好，再src目录下新建一个叫做constant（常量）目录，新建一个叫做typeList.ts文件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    export default Object.freeze([
  {text: '支出', value: '-'},
  {text: '收入', value: '+'},
]);//freeze的意思是只能读不允许修改
   
</code></pre></div><ol start="3"><li>引用Tabs.vue时候由于高度不同，需要在在引用这个组件里面传前缀来通过css修改这个高度，有时候会失败，这是因为选择器的优先级原因，要么提高引用组件时的css权重，或是降低组件自身在写css的样式的权重。在提供一条思路，就是选择用js来控制这个高度，</li></ol> <div class="language- extra-class"><pre class="language-text"><code> &lt;ul class=&quot;tabs&quot; :class=&quot;{[classPrefix+'-tabs']: classPrefix}&quot; :style=&quot;{height:height}&quot;&gt;
    &lt;li v-for=&quot;item in dataSource&quot; :key=&quot;item.value&quot; class=&quot;tabs-item&quot;
        :class=&quot;liClass(item)&quot; @click=&quot;select(item)&quot;&gt;{{item.text}}
    &lt;/li&gt;
  &lt;/ul&gt;
@Prop({type: String, default: '64px'})
    height!: string;
    
</code></pre></div><ol start="4"><li>书写statistics.vue的页面内容，完成列表的内容，首先我们可以拿到recordList,这是一个数组，他是一个</li></ol> <div class="language- extra-class"><pre class="language-text"><code> RecordItem = {
  tags: string[]
  notes: string
  type: string
  amount: number // 数据类型 object | string
  createdAt?: Date  // 类 / 构造函数
}
</code></pre></div><p>由于通过this.$store来取这个recordList的时候，它的类型会变成一个any,所以当我们拿到这个recordList的时候，我们需要自己断言一下这是个recordItem类型，</p> <div class="language- extra-class"><pre class="language-text"><code>get recordList() {
      return (this.$store.state as RootState).recordList;
    }
</code></pre></div><p>但是当我们从localStroge取出这个recordList的时候，JSON.parse并不识别Date类型，所以我们需要将createAt的类型修改一下，变成一个string，这就使得将有createAt的地方修改一下， <code>record2.createdAt = new Date().toISOString()</code>;</p> <ol start="4"><li>拿到recordList以后，我们需要将这个数组做成我们需要的结构类似于下面这种,然后就开始写css样式</li></ol> <div class="language- extra-class"><pre class="language-text"><code>   &lt;li v-for=&quot;(group,index) in result&quot; :key=&quot;index&quot;&gt;
        &lt;h3 class=&quot;title&quot;&gt;{{group.title}}&lt;/h3&gt;
        &lt;ol&gt;
          &lt;li v-for=&quot;item in group.items&quot; :key=&quot;item.id&quot;
              class=&quot;record&quot;
          &gt;
            &lt;span&gt;{{tagString(item.tags)}}&lt;/span&gt;
            &lt;span class=&quot;notes&quot;&gt;{{item.notes}}&lt;/span&gt;
            &lt;span&gt;￥{{item.amount}} &lt;/span&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
  get result() {
      const {recordList} = this;
      type HashTableValue = { title: string, items: RecordList }
      const hashTable: { [key: string]: HashTableValue } = {};
      for (let i = 0; i &lt; recordList.length; i++) {
        const [date, time] = recordList[i].createdAt!.split('T');
        hashTable[date] = hashTable[date] || {title: date, items: []};
        hashTable[date].items.push(recordList[i]);
      }
      return hashTable;
    }
</code></pre></div><ol start="5"><li>关于时间的概念，知识总结。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    let day=new Date()//得到一个事件
    console.log(day)//Wed Aug 12 2020 16:22:13 GMT+0800 (中国标准时间)
    day.toISOString()//&quot;2020-08-12T08:22:13.036Z&quot;
    Date.parse(&quot;2020-08-12T08:22:13.036Z&quot;)//1597220533036
    new Date(1597220533036)//Wed Aug 12 2020 16:22:13 GMT+0800 (中国标准时间)
    new Date(1597220533036).getHours()//16
    ```
    使用dayjs,采用crm学习法。首先进入官网然后安装，开始使用,以后还有什么需要学习的就自己去搜索
    ```
      import dayjs from 'dayjs';
       beautify(string: string) {
      const now = new Date();//也可以是const now=dayjs()
      if (dayjs(string).isSame(now, 'day')) {
        return '今天';
      } else if (dayjs(string).isSame((now.valueOf() - 86400 * 1000), 'day')) {
        return '昨天';
      } else if (dayjs(string).isSame(dayjs().subtract(2, 'day'), 'day')) {
        return '前天';
      } else if (dayjs(string).isSame(now, 'year')) {
        return dayjs(string).format('M月D日');
      } else {
        return dayjs(string).format('yyyy年MM月DD日');
      }
    }
</code></pre></div><ol start="6"><li>为了让在统计页面显示的数据是有序的，今天，昨天，前天，与更早的时间，我么需要在得到hashTable之前就将这个recordList排好序</li></ol> <div class="language- extra-class"><pre class="language-text"><code>     function clone&lt;T&gt;(data: T): T{
    return JSON.parse(JSON.stringify(data))
       }//上述中的三个T分别代表着 第一个声明一个T类型，第二个data的类型为T,第三个为返回值类型为T
  
 export default clone
   const newList = clone(recordList).sort((a, b) =&gt;  dayjs(b.createdAt).valueOf() - dayjs(a.createdAt).valueOf())
</code></pre></div><ol start="7"><li>然后开始改造hashTable，使他变成一个数组</li></ol> <div class="language- extra-class"><pre class="language-text"><code>   const hashTable: HashTable = [{title: dayjs(newList[0].createdAt).format('YYYY-MM-DD'), items: [newList[0]]}];
    for (let i = 1; i &lt; newList.length; i++) {
      const current = newList[i];
      const last = hashTable[hashTable.length - 1];
      if (dayjs(current.createdAt).isSame(dayjs(last.title), 'day')) {
        last.items.push(current);
      } else {
        hashTable.push({title: dayjs(current.createdAt).format('YYYY-MM-DD'), items: [current]});
      }
      上面样式也得改动
       &lt;ol&gt;
    &lt;li v-for=&quot;(group,index) in groupList&quot; :key=&quot;index&quot;&gt;
      &lt;h3 class=&quot;title&quot;&gt;
        {{beautify(group.title)}}&lt;span&gt;{{group.total}}&lt;/span&gt;
      &lt;/h3&gt;
      &lt;ol&gt;
        &lt;li v-for=&quot;item in group.items&quot; :key=&quot;item.id&quot;
            class=&quot;record&quot;&gt;
          &lt;span&gt;{{tagString(item.tags)}}&lt;/span&gt;
          &lt;span class=&quot;notes&quot;&gt;{{item.notes}}&lt;/span&gt;
          &lt;span&gt;￥{{item.amount}} &lt;/span&gt;
        &lt;/li&gt;
      &lt;/ol&gt;
    &lt;/li&gt;
   &lt;/ol&gt;                                                                                              
</code></pre></div><ol start="8"><li>页面最好是每天的花费再做一个统计总额度,</li></ol> <div class="language- extra-class"><pre class="language-text"><code>   type HashTable={
   title: string;
   total?: number;
   items: RecordList;
    }[ ]//声明类型
     hashTable.map(group =&gt; {
        group.total = group.items.reduce((sum, item) =&gt; {return sum + item.amount;}, 0);
      });
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yangyang-blog/project/money-vue/标签编辑页面.html" class="prev">
        制作标签编辑页面
      </a></span> <span class="next"><a href="/yangyang-blog/project/money-vue/页面数据可视化.html">
        统计页面数据可视化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yangyang-blog/assets/js/app.a824f6ad.js" defer></script><script src="/yangyang-blog/assets/js/2.8963be7f.js" defer></script><script src="/yangyang-blog/assets/js/51.6f6b1a0c.js" defer></script>
  </body>
</html>
